<html>
<head>
	<title>Websockets Using JavaScript MQTT Client</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="mqttjs2013.js" type="text/javascript"></script>
	<script src="connect.js" type="text/javascript"></script>
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script type="text/javascript">
		var y = 0;
		function onMessageArrived(r_message) {
			out_msg = "Message received " + r_message.payloadString + "<br>";
			out_msg = out_msg + "Message received Topic " + r_message.destinationName;
			//console.log("Message received ",r_message.payloadString);
			//console.log(out_msg);
			y = parseFloat(r_message.payloadString);
			$(".terminal").text(r_message.payloadString);
			//document.getElementById("messages").innerHTML = out_msg;
			//console.log(r_message.payloadString);
            add();
		}
		function Connected() {
			sub_topics('/bekti/lux');
		}
		$(document).ready(function () {
			MQTTconnect('broker.hivemq.com', 8884);
		}); 
	</script>

</head>

<style>
	.hr {
		background-color: black;
		height: 50px;
		width: 2px;
	}
</style>
</head>

<body style="margin: 0;">
	<div style="display: flex; align-items: center; justify-content: center;">
		<div style="text-align: center;   margin: 10px;  ">
			<div style="font-size: 40px; display: flex; justify-content: center; align-items: center; width: 400px;">
				<div style="width: 380px; text-align: left;">Lux Meter
				</div>
				<div class="status"
					style="border-radius: 10px; background-color: rgb(0, 0, 0); width: 10px; height: 10px;">
				</div>
			</div>
			<hr>
			<div class="terminal">

			</div>
			<div>
				<div id="chartvoltage" class="container" style="margin-top: 40px; width: 400px; height: 400px;"></div>
				<script>
					var chartA = new Highcharts.Chart({
						chart: { renderTo: 'chartvoltage' },
						title: { text: 'Lux Meter' },
						series: [{
							showInLegend: false,
							data: []
						}],
						plotOptions: {
							line: {
								animation: false,
								dataLabels: { enabled: true }
							},
							series: { color: '#059e8a' }
						},
						xAxis: {
							type: 'datetime',
							dateTimeLabelFormats: { second: '%H:%M:%S' }
						},
						yAxis: {
							title: { text: 'Lux' }
						},
						credits: { enabled: false }
					});
					function  add() {
						var x = (new Date()).getTime()
							y= y/1000;
							y=parseInt(y);
						if (chartA.series[0].data.length > 40) {
							chartA.series[0].addPoint([x, y], true, true, true);
						} else {
							chartA.series[0].addPoint([x, y], true, false, true);
						}
					}
				</script>
			</div>
		</div>
	</div>



</body>

</html>